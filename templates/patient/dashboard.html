{% extends "base.html" %}

{% block content %}
<h1>Patient Dashboard</h1>

<div style="margin-bottom: 30px; padding: 20px; background: #f9f9f9; border-radius: 5px;">
    <h2>Book a New Appointment</h2>
    <form method="POST" action="{{ url_for('find_doctors') }}">
        <label for="specialization_id">Specialization:</label>
        <select id="specialization_id" name="specialization_id" required>
            <option value="">-- Select Specialization --</option>
            {% for specialization in specializations %}
                <option value="{{ specialization['id'] }}">{{ specialization['name'] }}</option>
            {% endfor %}
        </select>
        
        <label for="appointment_date">Select Date:</label>
        <input type="date" id="appointment_date" name="appointment_date" required min="{{ today }}">
        
        <button type="submit">Find Available Doctors</button>
    </form>
</div>

<hr>

<div style="padding: 20px; background: #ffffff; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 30px;">
    <h2>Your Upcoming Bookings</h2>
    {% if upcoming_appointments %}
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Doctor</th>
                    <th>Specialization</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for appt in upcoming_appointments %}
                    <tr>
                        <td>{{ appt['date'] }}</td>
                        <td>{{ appt['time'] }}</td>
                        <td>Dr. {{ appt['doctor_name'] }}</td>
                        <td>{{ appt['specialization_name'] }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('patient_cancel_booking', appointment_id=appt['id']) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to CANCEL this booking?')">
                                <button type="submit" style="padding: 5px 10px; background: #a61c00;">Cancel Booking</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">You have no booked appointments.</div>
    {% endif %}
</div>

<div style="padding: 20px; background: #ffffff; border-radius: 5px; border: 1px solid #ddd;">
    <h2>Appointment History</h2>
    {% if history_appointments %}
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Doctor</th>
                    <th>Status</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% for appt in history_appointments %}
                    <tr>
                        <td>{{ appt['date'] }}</td>
                        <td>{{ appt['time'] }}</td>
                        <td>Dr. {{ appt['doctor_name'] }}</td>
                        <td>
                            <span style="font-weight: bold; color: 
                                {% if appt['status'] == 'Completed' %}green
                                {% elif appt['status'] == 'Cancelled' %}red
                                {% else %}gray
                                {% endif %};">
                                {{ appt['status'] }}
                            </span>
                        </td>
                        <td>
                            {% if appt['has_treatment'] %}
                                <a href="{{ url_for('view_patient_treatment', appointment_id=appt['id']) }}" class="button" style="padding: 5px 10px; background: #007bff;">View Treatment</a>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No past appointment history.</p>
    {% endif %}
</div>

{% endblock %}